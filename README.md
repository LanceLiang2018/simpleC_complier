# simpleC_complier

参考c4完成的C语言编译器,代码逻辑大部分跟c4相同,但是确实是自己理解了并重写,附有大量中文注释。

一个最简单的编译器经过的大致步骤即:词法分析-->语法分析-->语义分析-->代码生成

本项目并没有代码生成,而是直接产生运行结果,所以这其实是一个解释器。解释器和编译器的区别就在于,解释器直接将运行结果回送,而编译器会成目标代码供你运行。

代码中设计了自己的指令集和虚拟机来运行得出结果。

## 词法分析

词法分析将源代码生成为记号流(会过滤掉空格等不必要的信息),以供下一阶段的语法分析使用,而每个记号由记号本身和记号的值组成,比如一个变量a,对应的记号可能为(ID,a)
 
在本项目中,词法分析对应`next()`函数,它并不是将源代码一次性处理成记号流,这样做的好处是可以根据源代码的上下文来灵活分析。并且未采用编译原理课程中讲述的正则表达式、自动机等概念。
- 主要的思想就是通过预处理关键字并通过前看符号来分析源代码并将正确的记号存入符号表中。
- 主逻辑：
```
while(token = *src_pos++)
{ 
   if(...)
   {
    ...
   }
   else if(...)
   {
    ...
    return; //匹配成功了才return
   }
}
```
- 处理变量部分采用hash的方式,将合法的变量名存入符号表(判断变量是否存在的方法即通过比较hash值以及字符)
- 处理数字部分唯一需要注意的就是十六进制,c4的源码部分为`ival = ival * 16 + (tk & 15) + (tk >= 'A' ? 9 : 0);`,这样写虽然简洁,但是可能难懂。
- 处理字符部分需要区分字符串和单字符,如果是字符串,则需要记录起始位置,并存入data段中;单字符则直接将其类型保存为Num
- 其他部分不需要太多说明,具体可看注释

